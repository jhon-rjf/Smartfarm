# 🎙️ Voice to Voice 기능 가이드

## 📋 개요

MyApp 스마트 온실 시스템에 **Google Gemini 2.0 Flash Exp**를 사용한 실시간 Voice to Voice 기능이 추가되었습니다.

농업 종사자분들이 음성으로 온실을 제어하고 정보를 확인할 수 있습니다.

## 🚀 설치 및 설정

### 1. **백엔드 의존성 설치**

```bash
cd MyApp/backend
pip install flask-socketio==5.3.6 google-genai==0.1.0 sounddevice==0.4.6 websockets==12.0
```

### 2. **프론트엔드 의존성 설치**

```bash
cd MyApp
npm install socket.io-client@^4.7.2
expo install expo-av
```

### 3. **환경 변수 설정**

`.env` 파일에 Google Gemini API 키가 설정되어 있는지 확인:

```env
GEMINI_API_KEY=your_google_gemini_api_key_here
```

## 🔧 서버 실행

### 1. **기존 Flask 서버** (포트 5001)
```bash
cd MyApp/backend
python app.py
```

### 2. **Voice to Voice 서버** (포트 5002)
```bash
cd MyApp/backend  
python voice_to_voice.py
```

## 📱 사용법

### 1. **앱에서 Voice Test 탭 선택**
- 하단 네비게이션에서 마이크 아이콘 탭 선택

### 2. **서버 연결**
- "서버 연결" 버튼을 눌러 Voice 서버(포트 5002)에 연결
- 연결 상태가 "서버 연결됨"으로 변경되는지 확인

### 3. **음성 세션 시작**
- "음성 세션 시작" 버튼을 눌러 Gemini Live 세션 활성화
- "음성 세션 준비됨" 표시가 나타나는지 확인

### 4. **음성 대화**
- "녹음 시작" 버튼을 눌러 음성 입력 시작
- 현재는 3초 자동 녹음 후 중지 (테스트용)
- AI 응답이 자동으로 재생됩니다

## 🎯 기능 특징

### **음성 입력 예시**
- "온실 온도가 어때?"
- "습도 알려줘"
- "조명 켜줘"
- "팬 꺼줘"
- "식물이 건강한가?"

### **AI 응답 특징**
- **노년층 친화적**: 쉽고 간단한 언어 사용
- **간결한 응답**: 2-3문장 이내
- **실시간 데이터**: 현재 온실 상태 반영
- **액션 제어**: 장치 제어 명령 인식

## 💰 비용 정보

### **Google Gemini 2.0 Flash Exp**
- **현재**: 무료 또는 매우 저렴 (실험 단계)
- **예상**: 정식 출시 후 요금제 적용 예정

### **대안 비교**
| 방식 | 비용 | 품질 | 지연시간 |
|------|------|------|----------|
| OpenAI Realtime API | ~$1/분 | 최고 | 2-3초 |
| Gemini 2.0 Flash Exp | 무료/저렴 | 양호 | 3-5초 |
| STT+LLM+TTS 조합 | ~$0.12/분 | 보통 | 5-10초 |

## 🔧 고급 설정

### **서버 IP 변경**
`VoiceTestScreen.js` 파일의 서버 URL 수정:

```javascript
const VOICE_SERVER_URL = 'http://YOUR_SERVER_IP:5002';
```

### **프롬프트 커스터마이징**
`prompts.yaml` 파일에서 음성 대화용 프롬프트 수정 가능:

```yaml
chatbot_prompts:
  system_role: |
    당신은 스마트 온실 시스템의 전문가입니다. 
    노년층 농업 종사자가 이해하기 쉽게 설명해주세요.
```

### **녹음 시간 조정**
`VoiceTestScreen.js`에서 자동 중지 시간 변경:

```javascript
// 3초 후 자동 중지 (테스트용)
setTimeout(() => {
  if (recordingRef.current) {
    stopRecording();
  }
}, 3000); // 여기서 시간 조정 (밀리초)
```

## 🛠️ 문제 해결

### **연결 오류**
```
연결 오류: Voice 서버에 연결할 수 없습니다.
```
**해결책**:
1. Voice 서버(포트 5002)가 실행 중인지 확인
2. 방화벽에서 포트 5002 허용
3. 서버 IP 주소가 올바른지 확인

### **API 키 오류**
```
Gemini 클라이언트를 사용할 수 없습니다.
```
**해결책**:
1. `.env` 파일에 `GEMINI_API_KEY` 설정 확인
2. Google AI Studio에서 API 키 발급
3. 서버 재시작

### **음성 권한 오류**
```
오디오 설정 실패
```
**해결책**:
1. 앱 설정에서 마이크 권한 허용
2. 앱 재시작
3. 기기 마이크 하드웨어 확인

### **응답 재생 실패**
```
오디오 재생 실패
```
**해결책**:
1. 기기 볼륨 확인
2. 이어폰/스피커 연결 상태 확인
3. 앱 오디오 권한 확인

## 📊 성능 최적화

### **네트워크 최적화**
- WiFi 연결 사용 권장
- 5G/LTE 사용 시 데이터 요금 주의

### **배터리 최적화**
- 장시간 사용 시 충전기 연결 권장
- 백그라운드 앱 종료

### **음질 최적화**
- 조용한 환경에서 사용
- 마이크에서 10-30cm 거리 유지
- 명확한 발음으로 말하기

## 🔮 향후 개발 계획

### **실시간 스트리밍**
- 현재: 3초 단위 녹음
- 목표: 연속적인 실시간 음성 스트리밍

### **Wake Word 감지**
- "안녕 온실아" 같은 호출어로 활성화
- 항상 대기 모드

### **다중 언어 지원**
- 영어, 일본어 등 추가 언어
- 방언 및 억양 인식 개선

### **감정 인식**
- 사용자 감정 상태 파악
- 상황에 맞는 응답 톤 조절

## 📞 지원

문제가 발생하거나 개선 사항이 있으면 개발팀에 문의해주세요.

**상태 로그**를 통해 문제 진단이 가능하니 스크린샷과 함께 제보해주세요. 