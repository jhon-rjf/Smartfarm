# ğŸ¤– YAML ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

MyApp ìŠ¤ë§ˆíŠ¸ ì˜¨ì‹¤ ì‹œìŠ¤í…œì˜ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì„ **YAML íŒŒì¼**ë¡œ ì¤‘ì•™ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì´ì œ ëª¨ë“  AI í”„ë¡¬í”„íŠ¸ë¥¼ ì½”ë“œ ìˆ˜ì • ì—†ì´ `prompts.yaml` íŒŒì¼ì—ì„œ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
backend/
â”œâ”€â”€ prompts.yaml          # ğŸ¯ í”„ë¡¬í”„íŠ¸ ì„¤ì • ì¤‘ì•™ ê´€ë¦¬
â”œâ”€â”€ prompt_manager.py     # ğŸ”§ YAML ë¡œë” ë° í”„ë¡¬í”„íŠ¸ ë¹Œë”
â”œâ”€â”€ api_integration.py    # ğŸ¤– Gemini API í†µì‹  (YAML ì—°ë™)
â””â”€â”€ app.py               # ğŸŒ Flask ì„œë²„ (YAML ì—°ë™)
```

## ğŸ“ íŒŒì¼ êµ¬ì¡°

### 1. **prompts.yaml** - í”„ë¡¬í”„íŠ¸ ì„¤ì • íŒŒì¼
- ëª¨ë“  AI í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì¤‘ì•™ ê´€ë¦¬
- ì‹œìŠ¤í…œ ì„¤ì •, ì•¡ì…˜ íƒœê·¸ ì •ì˜
- ë‹¤êµ­ì–´ ì§€ì› ê°€ëŠ¥

### 2. **prompt_manager.py** - í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ì
- YAML íŒŒì¼ ë¡œë“œ ë° íŒŒì‹±
- ë™ì  í”„ë¡¬í”„íŠ¸ êµ¬ì„±
- ì˜¤ë¥˜ ì²˜ë¦¬ ë° í´ë°± ë©”ì»¤ë‹ˆì¦˜

### 3. **ìˆ˜ì •ëœ ê¸°ì¡´ íŒŒì¼ë“¤**
- `api_integration.py`: í•˜ë“œì½”ë”©ëœ í”„ë¡¬í”„íŠ¸ ì œê±°
- `app.py`: YAML ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
- `requirements.txt`: PyYAML ì˜ì¡´ì„± ì¶”ê°€

## ğŸ¯ YAML ì„¤ì • êµ¬ì¡°

### **ê¸°ë³¸ ì„¤ì •**
```yaml
system_config:
  model_temperature: 0.7      # AI ëª¨ë¸ ì°½ì˜ì„± ìˆ˜ì¤€
  max_output_tokens: 2048     # ìµœëŒ€ ì‘ë‹µ ê¸¸ì´
  response_language: "korean" # ì‘ë‹µ ì–¸ì–´
```

### **ì•¡ì…˜ íƒœê·¸**
```yaml
action_tags:
  light_on: "[ACTION_LIGHT_ON]"
  light_off: "[ACTION_LIGHT_OFF]"
  fan_on: "[ACTION_FAN_ON]"
  fan_off: "[ACTION_FAN_OFF]"
  # ... ê¸°íƒ€ ì¥ì¹˜ ì œì–´ íƒœê·¸
```

### **ì±—ë´‡ í”„ë¡¬í”„íŠ¸**
```yaml
chatbot_prompts:
  system_role: |
    ë‹¹ì‹ ì€ ìŠ¤ë§ˆíŠ¸ ì˜¨ì‹¤ ì‹œìŠ¤í…œì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    ì‹ë¬¼ì— ëŒ€í•´ì„œ ë§ì€ ê²ƒì„ ì•Œê³  ì‚¬ìš©ìë“¤ì—ê²Œ ì„¤ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
  action_guidelines: |
    1. ì‚¬ìš©ìê°€ ì¥ì¹˜ ì œì–´ë¥¼ ìš”ì²­í•  ê²½ìš° ë‹¤ìŒ ì•¡ì…˜ íƒœê·¸ë¥¼ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”:
       - ì¡°ëª… ì¼œê¸°: [ACTION_LIGHT_ON]
       - ì¡°ëª… ë„ê¸°: [ACTION_LIGHT_OFF]
       # ...
  
  examples:
    - user: "ë¶ˆ ì¼œì¤˜"
      bot: "ë„¤, ì¡°ëª…ì„ ì¼°ìŠµë‹ˆë‹¤. [ACTION_LIGHT_ON]"
    - user: "íŒ¬ êº¼ì¤˜"
      bot: "ë„¤, íŒ¬ì„ ê»ìŠµë‹ˆë‹¤. [ACTION_FAN_OFF]"
```

### **ì´ë¯¸ì§€ ë¶„ì„ í”„ë¡¬í”„íŠ¸**
```yaml
image_analysis_prompts:
  system_role: |
    ë‹¹ì‹ ì€ ìŠ¤ë§ˆíŠ¸ ì˜¨ì‹¤ ì‹œìŠ¤í…œì˜ ì‹ë¬¼ ë¶„ì„ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.
    ì‹ë¬¼ ê±´ê°• ìƒíƒœ, ì§ˆë³‘, ì˜ì–‘ ê²°í• ë“±ì„ ë¶„ì„í•˜ê³  ì ì ˆí•œ ì¡°ì¹˜ë¥¼ ì œì•ˆí•´ ì£¼ì„¸ìš”.
  
  analysis_guidelines: |
    ì´ë¯¸ì§€ ë¶„ì„ ì§€ì¹¨:
    1. ì‹ë¬¼ì˜ ì „ë°˜ì ì¸ ê±´ê°• ìƒíƒœë¥¼ í‰ê°€í•˜ì„¸ìš”.
    2. ìì˜ ìƒ‰ê¹”, ëª¨ì–‘, í¬ê¸°ë¥¼ ìì„¸íˆ ê´€ì°°í•˜ì„¸ìš”.
    # ...
```

## ğŸ”§ ì‚¬ìš©ë²•

### **1. ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ìƒì„±**
```python
from prompt_manager import get_chatbot_prompt, get_image_prompt

# ì±—ë´‡ í”„ë¡¬í”„íŠ¸ ìƒì„±
chatbot_prompt = get_chatbot_prompt(
    temperature=25.5,
    humidity=60.0,
    soil=45.0,
    power=120.0,
    device_status={'fan': False, 'light': True},
    user_message="ë¶ˆ ì¼œì¤˜"
)

# ì´ë¯¸ì§€ ë¶„ì„ í”„ë¡¬í”„íŠ¸ ìƒì„±
image_prompt = get_image_prompt(
    user_prompt="ì´ ì‹ë¬¼ì´ ê±´ê°•í•œê°€ìš”?",
    temperature=25.0,
    humidity=60.0,
    soil=50.0
)
```

### **2. ì„¤ì • ì¡°íšŒ**
```python
from prompt_manager import get_system_config, get_error_message

# ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ
config = get_system_config()
temperature = config['model_temperature']  # 0.7

# ì˜¤ë¥˜ ë©”ì‹œì§€ ì¡°íšŒ
error_msg = get_error_message('chat_error')
```

### **3. ì„¤ì • ë‹¤ì‹œ ë¡œë“œ**
```python
from prompt_manager import reload_prompts

# ì„œë²„ ì¬ì‹œì‘ ì—†ì´ YAML ì„¤ì • ë‹¤ì‹œ ë¡œë“œ
reload_prompts()
```

### **4. ì§ì ‘ PromptManager ì‚¬ìš©**
```python
from prompt_manager import prompt_manager

# ì•¡ì…˜ íƒœê·¸ ê°€ì ¸ì˜¤ê¸°
light_on_tag = prompt_manager.get_action_tag('light_on')  # [ACTION_LIGHT_ON]

# ê¸°ë³¸ ì‘ë‹µ ê°€ì ¸ì˜¤ê¸°
greeting = prompt_manager.get_default_response('greeting')
```

## ğŸ¨ í”„ë¡¬í”„íŠ¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### **1. ìƒˆë¡œìš´ ì¥ì¹˜ ì¶”ê°€**
```yaml
# prompts.yamlì— ì¶”ê°€
action_tags:
  heater_on: "[ACTION_HEATER_ON]"
  heater_off: "[ACTION_HEATER_OFF]"

chatbot_prompts:
  examples:
    - user: "íˆí„° ì¼œì¤˜"
      bot: "ë„¤, íˆí„°ë¥¼ ì¼°ìŠµë‹ˆë‹¤. [ACTION_HEATER_ON]"
```

### **2. ìƒˆë¡œìš´ ì–¸ì–´ ì§€ì›**
```yaml
# ì˜ì–´ í”„ë¡¬í”„íŠ¸ ì¶”ê°€
chatbot_prompts_en:
  system_role: |
    You are an expert in smart greenhouse systems.
    You can explain a lot about plants to users.
```

### **3. ì»¨í…ìŠ¤íŠ¸ í…œí”Œë¦¿ ìˆ˜ì •**
```yaml
context_templates:
  greenhouse_status: |
    Smart Greenhouse Status:
    - Temperature: {temperature}Â°C
    - Humidity: {humidity}%
    - Soil Moisture: {soil}%
    - Power Usage: {power}W
```

## ğŸš€ ê³ ê¸‰ ê¸°ëŠ¥

### **1. ë™ì  í”„ë¡¬í”„íŠ¸ êµ¬ì„±**
```python
# ëŸ°íƒ€ì„ì— í”„ë¡¬í”„íŠ¸ êµ¬ì„± ë³€ê²½
prompt_manager.config['chatbot_prompts']['system_role'] = "ìƒˆë¡œìš´ ì—­í•  ì •ì˜"

# íŠ¹ì • ì¡°ê±´ì— ë”°ë¥¸ í”„ë¡¬í”„íŠ¸ ë³€ê²½
if user_level == 'expert':
    prompt = get_expert_chatbot_prompt(...)
else:
    prompt = get_basic_chatbot_prompt(...)
```

### **2. A/B í…ŒìŠ¤íŠ¸ ì§€ì›**
```yaml
# ë‹¤ì–‘í•œ í”„ë¡¬í”„íŠ¸ ë²„ì „ ì •ì˜
chatbot_prompts_v1:
  system_role: "ê¸°ë³¸ ë²„ì „ í”„ë¡¬í”„íŠ¸"

chatbot_prompts_v2:
  system_role: "ê°œì„ ëœ ë²„ì „ í”„ë¡¬í”„íŠ¸"
```

### **3. ì¡°ê±´ë¶€ í”„ë¡¬í”„íŠ¸**
```python
def get_conditional_prompt(user_type, season, time_of_day):
    base_prompt = prompt_manager.get_basic_system_prompt()
    
    if season == 'winter':
        base_prompt += "\nê²¨ìš¸ì²  ì˜¨ì‹¤ ê´€ë¦¬ì— íŠ¹íˆ ì£¼ì˜í•´ì£¼ì„¸ìš”."
    
    if time_of_day == 'night':
        base_prompt += "\nì•¼ê°„ ëª¨ë“œë¥¼ ê³ ë ¤í•œ ì¡°ëª… ê´€ë¦¬ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”."
    
    return base_prompt
```

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ

### **1. ìƒˆë¡œìš´ í”„ë¡¬í”„íŠ¸ íƒ€ì… ì¶”ê°€**
```python
# prompt_manager.pyì— ìƒˆ ë©”ì„œë“œ ì¶”ê°€
def get_weather_prompt(self, location, conditions):
    weather_prompts = self.config.get('weather_prompts', {})
    template = weather_prompts.get('forecast_template', '')
    return template.format(location=location, conditions=conditions)
```

### **2. ê²€ì¦ ì‹œìŠ¤í…œ ì¶”ê°€**
```python
def validate_prompt_config(self):
    """YAML ì„¤ì • ìœ íš¨ì„± ê²€ì‚¬"""
    required_keys = ['system_config', 'chatbot_prompts', 'action_tags']
    for key in required_keys:
        if key not in self.config:
            raise ValueError(f"í•„ìˆ˜ ì„¤ì • í‚¤ ëˆ„ë½: {key}")
```

### **3. ìºì‹± ì‹œìŠ¤í…œ**
```python
from functools import lru_cache

@lru_cache(maxsize=100)
def get_cached_prompt(prompt_type, **kwargs):
    """ìì£¼ ì‚¬ìš©ë˜ëŠ” í”„ë¡¬í”„íŠ¸ ìºì‹±"""
    if prompt_type == 'chatbot':
        return get_chatbot_prompt(**kwargs)
    elif prompt_type == 'image':
        return get_image_prompt(**kwargs)
```

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### **1. í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ìµœì í™”**
```yaml
# ê°„ê²°í•œ ë²„ì „ê³¼ ìƒì„¸í•œ ë²„ì „ ë¶„ë¦¬
chatbot_prompts:
  brief_guidelines: "ê°„ë‹¨í•œ ì§€ì¹¨ë“¤..."
  detailed_guidelines: "ìƒì„¸í•œ ì§€ì¹¨ë“¤..."

prompt_composition:
  quick_mode: ["system_role", "brief_guidelines"]
  full_mode: ["system_role", "detailed_guidelines", "examples"]
```

### **2. ì§€ì—° ë¡œë”©**
```python
class LazyPromptManager:
    def __init__(self):
        self._config = None
    
    @property
    def config(self):
        if self._config is None:
            self._config = self._load_config()
        return self._config
```

## ğŸ” ë””ë²„ê¹… ë° ëª¨ë‹ˆí„°ë§

### **1. í”„ë¡¬í”„íŠ¸ ë¡œê¹…**
```python
import logging

# í”„ë¡¬í”„íŠ¸ ì‚¬ìš© ë¡œê·¸
logging.info(f"í”„ë¡¬í”„íŠ¸ ìƒì„±: íƒ€ì…={prompt_type}, ê¸¸ì´={len(prompt)}")
```

### **2. í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬**
```yaml
meta:
  version: "1.2.0"
  last_updated: "2024-01-15"
  author: "AI Team"
  changelog:
    - "v1.2.0: ì´ë¯¸ì§€ ë¶„ì„ í”„ë¡¬í”„íŠ¸ ê°œì„ "
    - "v1.1.0: ìƒˆë¡œìš´ ì•¡ì…˜ íƒœê·¸ ì¶”ê°€"
```

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### **ì‹œë‚˜ë¦¬ì˜¤ 1: ìƒˆë¡œìš´ ì„¼ì„œ ì¶”ê°€**
```yaml
# 1. prompts.yamlì— ìƒˆ ì„¼ì„œ ì¶”ê°€
context_templates:
  greenhouse_status: |
    ìŠ¤ë§ˆíŠ¸ ì˜¨ì‹¤ ì‹œìŠ¤í…œ ì •ë³´:
    - ì˜¨ë„: {temperature}Â°C
    - ìŠµë„: {humidity}%
    - í† ì–‘ ìŠµë„: {soil}%
    - ì „ë ¥ ì‚¬ìš©ëŸ‰: {power}W
    - CO2 ë†ë„: {co2}ppm  # ìƒˆë¡œ ì¶”ê°€
```

```python
# 2. ì½”ë“œì—ì„œ ìƒˆ ì„¼ì„œ ë°ì´í„° ì‚¬ìš©
prompt = get_chatbot_prompt(
    temperature=25.0,
    humidity=60.0,
    soil=45.0,
    power=120.0,
    co2=400,  # ìƒˆ ì„¼ì„œ ë°ì´í„°
    user_message="CO2 ë†ë„ê°€ ì–´ë•Œ?"
)
```

### **ì‹œë‚˜ë¦¬ì˜¤ 2: ë‹¤êµ­ì–´ ì§€ì›**
```yaml
# í•œêµ­ì–´ ì„¤ì •
chatbot_prompts_ko:
  greeting: "ì•ˆë…•í•˜ì„¸ìš”! ìŠ¤ë§ˆíŠ¸ ì˜¨ì‹¤ ê´€ë¦¬ë¥¼ ë„ì™€ë“œë¦´ê²Œìš”."

# ì˜ì–´ ì„¤ì •  
chatbot_prompts_en:
  greeting: "Hello! I'll help you manage your smart greenhouse."
```

```python
# ì–¸ì–´ë³„ í”„ë¡¬í”„íŠ¸ ì„ íƒ
def get_localized_prompt(language='ko', **kwargs):
    if language == 'en':
        return get_english_chatbot_prompt(**kwargs)
    else:
        return get_chatbot_prompt(**kwargs)
```

## ğŸ”§ ìœ ì§€ë³´ìˆ˜

### **ì •ê¸° ì‘ì—…**
1. **í”„ë¡¬í”„íŠ¸ ì„±ëŠ¥ ë¶„ì„**: AI ì‘ë‹µ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§
2. **ì„¤ì • ë°±ì—…**: `prompts.yaml` ì •ê¸° ë°±ì—…
3. **ë²„ì „ ê´€ë¦¬**: Gitì„ í†µí•œ í”„ë¡¬í”„íŠ¸ ë³€ê²½ì‚¬í•­ ì¶”ì 
4. **A/B í…ŒìŠ¤íŠ¸**: ìƒˆë¡œìš´ í”„ë¡¬í”„íŠ¸ ë²„ì „ í…ŒìŠ¤íŠ¸

### **ë¬¸ì œ í•´ê²°**
```bash
# ì„¤ì • íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
python3 -c "import yaml; yaml.safe_load(open('prompts.yaml'))"

# í”„ë¡¬í”„íŠ¸ ë§¤ë‹ˆì € í…ŒìŠ¤íŠ¸
python3 prompt_manager.py

# ë°±ì—”ë“œ ì„œë²„ ì¬ì‹œì‘
python3 app.py
```

ì´ì œ MyAppì˜ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì´ **ì™„ì „íˆ YAML ê¸°ë°˜ìœ¼ë¡œ ì¤‘ì•™ ê´€ë¦¬**ë©ë‹ˆë‹¤!

## âœ¨ ì£¼ìš” ì¥ì 

1. **ì½”ë“œ ìˆ˜ì • ì—†ì´ í”„ë¡¬í”„íŠ¸ ë³€ê²½** ğŸ”„
2. **ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬** ğŸ“  
3. **ë²„ì „ ê´€ë¦¬ ë° ë°±ì—…** ğŸ’¾
4. **ë‹¤êµ­ì–´ ì§€ì› ê°€ëŠ¥** ğŸŒ
5. **A/B í…ŒìŠ¤íŠ¸ ìš©ì´** ğŸ§ª
6. **ì „ë¬¸ì ì´ê³  ê°„ê²°í•œ í†¤** ğŸ’¼ 